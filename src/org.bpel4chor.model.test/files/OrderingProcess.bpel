<!-- OrderingProcess BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Mon Nov 07 20:51:05 CET 2011 -->
<bpel:process name="OrderingProcess"
         targetNamespace="http://www.iaas.uni-stuttgart.de"
         suppressJoinFailure="yes"
         xmlns:tns="http://www.iaas.uni-stuttgart.de"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         exitOnStandardFault="no" xmlns:ns1="http://www.w3.org/2001/XMLSchema" 
         xmlns:ns3="http://www.iaas.uni-stuttgart.deArtifacts">
         
    <!-- Import the client WSDL -->
    <bpel:import namespace="http://www.iaas.uni-stuttgart.de" location="ProcessPayment.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import namespace="http://www.iaas.uni-stuttgart.de" location="ProcessOrder.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import namespace="http://www.iaas.uni-stuttgart.de" location="TypeSchema.xsd" importType="http://www.w3.org/2001/XMLSchema"></bpel:import>
    <bpel:import namespace="http://www.iaas.uni-stuttgart.de" location="OrderingProcess.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->             
    
    <bpel:partnerLinks>
        <bpel:partnerLink name="orderingPL" partnerLinkType="tns:OrderingProcessPT" myRole="OrderProcessProvider"></bpel:partnerLink>
        
        
       
        
        
        <bpel:partnerLink name="processOrderPL" partnerLinkType="tns:ProcessOrderPT" partnerRole="ProcessOrder"></bpel:partnerLink>
        <bpel:partnerLink name="processPaymentPL" partnerLinkType="tns:ProcessPaymentPT" partnerRole="ProcessPayment"></bpel:partnerLink>
    </bpel:partnerLinks>
    <bpel:variables>
        <bpel:variable name="orderInfo" messageType="tns:orderRequest"></bpel:variable>
        
        <bpel:variable name="response" messageType="tns:orderResponse"></bpel:variable>
        
        <bpel:variable name="paymentInfo" messageType="tns:processPaymentRequest"></bpel:variable>
        <bpel:variable name="delivered" element="tns:Delivered"></bpel:variable>
        
        <bpel:variable name="processOrderPLRequest" messageType="tns:processOrderRequest"></bpel:variable>
    </bpel:variables>
    <bpel:flow name="Flow">
    <bpel:links>
		<bpel:link name="ReceiveA2AssignB"></bpel:link>
		<bpel:link name="AssignB2C"></bpel:link>
		<bpel:link name="AssignB2E"></bpel:link>
		<bpel:link name="AssignB2D"></bpel:link>
		<bpel:link name="AssignC2E"></bpel:link>
		<bpel:link name="AssignD2E"></bpel:link>
        <bpel:link name="AssignE2InvokeF"></bpel:link>
		<bpel:link name="InvokeF2G"></bpel:link>
		<bpel:link name="InvokeF2ReplyH"></bpel:link>
        </bpel:links>
	<bpel:receive name="ReceiveA" createInstance="yes" partnerLink="orderingPL" operation="order" portType="tns:OrderingProcess" variable="orderInfo">
		<bpel:sources>
			<bpel:source linkName="ReceiveA2AssignB"></bpel:source>
		</bpel:sources>
	</bpel:receive>
	<bpel:assign validate="no" name="AssignB">
		<bpel:targets>
			<bpel:target linkName="ReceiveA2AssignB"></bpel:target>
		</bpel:targets>
		<bpel:sources>
			
			<bpel:source linkName="AssignB2C">
                    <bpel:transitionCondition><![CDATA[contains($orderInfo.payload/tns:status,"gold")]]></bpel:transitionCondition>
                </bpel:source>
			<bpel:source linkName="AssignB2D">
                    <bpel:transitionCondition><![CDATA[contains($orderInfo.payload/tns:status,"silver")]]></bpel:transitionCondition>
                </bpel:source>
            <bpel:source linkName="AssignB2E"></bpel:source>
            
            </bpel:sources>
            
            <bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <p:Response xmlns:p="http://www.iaas.uni-stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><p:text>p:text</p:text>

                        </p:Response>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="response" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <p:PaymentInfo xmlns:p="http://www.iaas.uni-stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><p:amt>0</p:amt>
  <p:actNum>p:actNum</p:actNum>

                        </p:PaymentInfo>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="paymentInfo" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="orderInfo">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:acountNumber]]>
                    </bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="paymentInfo">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:actNum]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    <![CDATA[string("Dear customer,...")]]>
                </bpel:from>
                <bpel:to part="payload" variable="response">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:text]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    
                    
                    
                    
                    <![CDATA[$orderInfo.payload/tns:orderTotalPrice + 5*$orderInfo.payload/tns:numDeliveries]]>
                </bpel:from>
                <bpel:to part="payload" variable="paymentInfo">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:amt]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
	<bpel:assign validate="no" name="AssignC">
		<bpel:targets>
			<bpel:target linkName="AssignB2C"></bpel:target>
		</bpel:targets>
		<bpel:sources>
			<bpel:source linkName="AssignC2E"></bpel:source>
		</bpel:sources>
            <bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <p:Response xmlns:p="http://www.iaas.uni-stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><p:text>p:text</p:text>

                        </p:Response>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="response" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <p:PaymentInfo xmlns:p="http://www.iaas.uni-stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><p:amt>0</p:amt>
  <p:actNum>p:actNum</p:actNum>

                        </p:PaymentInfo>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="paymentInfo" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    
                    
                    <![CDATA[concat($response.payload/tns:text, "10% discount")]]>
                </bpel:from>
                <bpel:to part="payload" variable="response">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:text]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    
                    
                    
                    <![CDATA[$paymentInfo.payload/tns:amt*0.9]]>
                </bpel:from>
                <bpel:to part="payload" variable="paymentInfo">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:amt]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
	<bpel:assign validate="no" name="AssignD">
		<bpel:targets>
			<bpel:target linkName="AssignB2D"></bpel:target>
		</bpel:targets>
		<bpel:sources>
			<bpel:source linkName="AssignD2E"></bpel:source>
		</bpel:sources>
            <bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <p:Response xmlns:p="http://www.iaas.uni-stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><p:text>p:text</p:text>

                        </p:Response>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="response" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <p:PaymentInfo xmlns:p="http://www.iaas.uni-stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><p:amt>0</p:amt>
  <p:actNum>p:actNum</p:actNum>

                        </p:PaymentInfo>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="paymentInfo" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    
                    
                    <![CDATA[concat($response.payload/tns:text, " 5% discount")]]>
                </bpel:from>
                <bpel:to part="payload" variable="response">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:text]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    
                    
                    
                    <![CDATA[$paymentInfo.payload/tns:amt*0.95]]>
                </bpel:from>
                <bpel:to part="payload" variable="paymentInfo">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:amt]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
	<bpel:assign validate="no" name="AssignE">
		<bpel:targets>
            <bpel:target linkName="AssignB2E"></bpel:target>
            <bpel:target linkName="AssignC2E"></bpel:target>
            <bpel:target linkName="AssignD2E"></bpel:target>
            </bpel:targets>
		<bpel:sources>
			<bpel:source linkName="AssignE2InvokeF"></bpel:source>
		</bpel:sources>
            <bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <p:OrderInfo xmlns:p="http://www.iaas.uni-stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><p:acountNumber>p:acountNumber</p:acountNumber>
  <p:oderStatus>p:oderStatus</p:oderStatus>
  <p:orderTotalPrice>0</p:orderTotalPrice>
  <p:status>p:status</p:status>
  <p:numDeliveries>0</p:numDeliveries>

                        </p:OrderInfo>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="processOrderPLRequest" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    <![CDATA[string("pricess calculated")]]>
                </bpel:from>
                <bpel:to part="payload" variable="orderInfo">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:oderStatus]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from>
                    <bpel:literal xml:space="preserve"><p:Delivered xmlns:p="http://www.iaas.uni-stuttgart.de" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">0</p:Delivered>
</bpel:literal>
                </bpel:from>
                <bpel:to variable="delivered"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="orderInfo"></bpel:from>
                <bpel:to part="payload" variable="processOrderPLRequest"></bpel:to>
            </bpel:copy>
        </bpel:assign>
	<bpel:invoke name="InvokeF" partnerLink="processOrderPL" operation="processOrder" portType="tns:ProcessOrder" inputVariable="processOrderPLRequest">
		<bpel:targets>
			<bpel:target linkName="AssignE2InvokeF"></bpel:target>
		</bpel:targets>
		<bpel:sources>
			<bpel:source linkName="InvokeF2G"></bpel:source>
			<bpel:source linkName="InvokeF2ReplyH"></bpel:source>
		</bpel:sources>
	</bpel:invoke>
	<bpel:invoke name="InvokeG" partnerLink="processPaymentPL" operation="processPayment" portType="tns:ProcessPayment" inputVariable="paymentInfo">
		<bpel:targets>
			<bpel:target linkName="InvokeF2G"></bpel:target>
		</bpel:targets>
	</bpel:invoke>
	<bpel:reply name="ReplyH" partnerLink="orderingPL" operation="order" portType="tns:OrderingProcess" variable="response">
		<bpel:targets>
			<bpel:target linkName="InvokeF2ReplyH"></bpel:target>
		</bpel:targets>
	</bpel:reply>
	
</bpel:flow>
<bpel:partnerLink name="processOrderPL" partnerLinkType="tns:PartnerLinkPLT" partnerRole="partnerRole"></bpel:partnerLink></bpel:process>

